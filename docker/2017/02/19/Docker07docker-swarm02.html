<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="hello,every body!"><title>docker1.12.3 docker-swarm集群服务部署与维护（二） | troyCoder</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">docker1.12.3 docker-swarm集群服务部署与维护（二）</h1><a id="logo" href="/.">troyCoder</a><p class="description">爱生活爱编程，分享学习工作中的知识和见解！</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/history/"><i class="fa fa-history"> 历史</i></a><a href="/guestbook/"><i class="fa fa-comments"> 留言</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">docker1.12.3 docker-swarm集群服务部署与维护（二）</h1><div class="post-meta">Feb 19, 2017<span> | </span><span class="category"><a href="/categories/docker/">docker</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a href="/docker/2017/02/19/Docker07docker-swarm02.html#comments" class="ds-thread-count cloud-tie-join-count"><span style="font-size: 15px; color: #6E7173;" class="join-count">0</span><span> 条参与</span></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#swarm服务运行的原理："><span class="toc-number">1.</span> <span class="toc-text">swarm服务运行的原理：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-swarm服务部署"><span class="toc-number">2.</span> <span class="toc-text">docker-swarm服务部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务部署实施："><span class="toc-number">3.</span> <span class="toc-text">服务部署实施：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BUILD服务所需的容器："><span class="toc-number">3.1.</span> <span class="toc-text">BUILD服务所需的容器：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建overlay网络："><span class="toc-number">3.2.</span> <span class="toc-text">创建overlay网络：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建bootService服务"><span class="toc-number">3.3.</span> <span class="toc-text">创建bootService服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建nginx服务"><span class="toc-number">3.4.</span> <span class="toc-text">创建nginx服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务的管理与测试"><span class="toc-number">4.</span> <span class="toc-text">服务的管理与测试</span></a></li></ol></div></div><div class="post-content"><p>在上一节中，我们已经搭建了docker swarm集群，并且完成对docker swarm集群的基本管理。<br>接下来我们讨论一下的原理以及怎么在搭建好的docker集群中部署集群服务。</p>
<h3 id="swarm服务运行的原理："><a href="#swarm服务运行的原理：" class="headerlink" title="swarm服务运行的原理："></a>swarm服务运行的原理：</h3><p>在docker swarm中部署应用程序，是通过创建service来实现，这里的service的概念通过是指在一个大的应用上下文中的一个微服务，比如在电商的购物网站中：用户管理、订单管理、库存管理，都是购物网站这个大应用中的一个一个微服务，这些服务可以是单个或者多个的在集群模式中运行。<br>service的类型可以是HTTP的应用程序、数据库、缓存服务等分布式环境中任何可执行的程序。<br><strong>service可定义的选项：</strong></p>
<ul>
<li>可以在swarm集群的外部提供访问服务的端口</li>
<li>可以通过覆盖网络(overlay)模式连接到群中的其他服务</li>
<li>可以设置CPU和内存限制和预留值</li>
<li>可以实现滚动更新策略</li>
<li>可以指定要在群中运行的镜像的副本数  </li>
</ul>
<p><strong>服务，任务和容器</strong><br>当您将服务部署到群集时，swarm管理器接受您的服务定义作为服务的所需状态。然后它在swarm中的节点上将服务调度为一个或多个副本任务。这些任务在群中的节点上彼此独立地运行。  </p>
<p><strong>下图解释服务、任务、容器：</strong> </p>
<p><img src="/images/docker/swarm/2-1.png" alt="服务、任务、容器">  </p>
<p><strong>服务的任务及调试说明：</strong>  </p>
<p><img src="/images/docker/swarm/2-2.png" alt="服务的任务及调试说明">  </p>
<p><strong>服务部署的复制模式和全局模式说明：</strong>  </p>
<p><img src="/images/docker/swarm/2-3.png" alt="服务部署的复制模式和全局模式说明"><br><strong>参考：</strong> <a href="https://docs.docker.com/engine/swarm/how-swarm-mode-works/services/" target="_blank" rel="external">https://docs.docker.com/engine/swarm/how-swarm-mode-works/services/</a></p>
<h3 id="docker-swarm服务部署"><a href="#docker-swarm服务部署" class="headerlink" title="docker-swarm服务部署"></a>docker-swarm服务部署</h3><ul>
<li><strong>环境如下：</strong>  </li>
</ul>
<table>
<thead>
<tr>
<th>IP</th>
<th>主机名</th>
<th>角色</th>
</tr>
</thead>
<tbody>
<tr>
<td>172.19.6.222</td>
<td>cloud01</td>
<td>manager</td>
</tr>
<tr>
<td>172.19.6.223</td>
<td>cloud02</td>
<td>worker</td>
</tr>
<tr>
<td>172.19.6.224</td>
<td>cloud03</td>
<td>worker</td>
</tr>
</tbody>
</table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@cloud01 ~]<span class="comment"># docker node ls</span></div><div class="line">ID                           HOSTNAME    STATUS  AVAILABILITY  MANAGER STATUS</div><div class="line">4sy84tap36r6vglmt4y0f3kyb    cloud02  Ready   Active        </div><div class="line">ap235xkm64tj0al4gdzqbpwmi *  cloud01  Ready   Active        Leader</div><div class="line">don6u2knphk92ugdvfgdymu2t    cloud03  Ready   Active</div></pre></td></tr></table></figure>
<ul>
<li><strong>服务部署规划：</strong>   </li>
</ul>
<table>
<thead>
<tr>
<th>服务名</th>
<th>副本数</th>
<th>网络</th>
<th>部署模式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>nginx</td>
<td>2</td>
<td>my-network</td>
<td>replicated</td>
<td>nginx服务依赖于bootservice服务  </td>
</tr>
<tr>
<td>bootService</td>
<td>3</td>
<td>my-network</td>
<td>replicatedl</td>
<td>bootservice服务依赖于mysql服务 </td>
</tr>
<tr>
<td>mysql</td>
<td>1</td>
<td>my-network</td>
<td>replicated</td>
<td>mysql服务  </td>
</tr>
</tbody>
</table>
<ul>
<li><strong>服务部署图：</strong>   </li>
</ul>
<p><img src="/images/docker/swarm/2-4.png" alt="服务流程图"></p>
<h3 id="服务部署实施："><a href="#服务部署实施：" class="headerlink" title="服务部署实施："></a>服务部署实施：</h3><h4 id="BUILD服务所需的容器："><a href="#BUILD服务所需的容器：" class="headerlink" title="BUILD服务所需的容器："></a>BUILD服务所需的容器：</h4><ul>
<li><strong>程序代码结构：</strong>  </li>
</ul>
<p><img src="/images/docker/swarm/2-5.png" alt="程序结构"></p>
<ul>
<li><strong>代码参考：</strong>   </li>
</ul>
<p><a href="https://github.com/troychn/springboot-docker-swarm" target="_blank" rel="external">github源代码</a><br><img src="/images/docker/swarm/2-6.png" alt="github源码"></p>
<p>把代码从github中下载下来，通过maven编译工具进行编译打包，一般都集成一些开发工具一起使用，我这里通过IDEA编译打包好的jar和dockerfile文件拷贝到docker环境下，如：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@dmpdev docker-swarm-service]<span class="comment"># ls</span></div><div class="line">bootService  mysql  nginx</div><div class="line">[root@dmpdev docker-swarm-service]<span class="comment"># ll</span></div><div class="line">总用量 0</div><div class="line">drwxr-xr-x. 2 root root 67 11月 30 17:42 bootService</div><div class="line">drwxr-xr-x. 2 root root 74 11月 30 17:42 mysql</div><div class="line">drwxr-xr-x. 2 root root 59 11月 30 17:42 nginx</div></pre></td></tr></table></figure>
<ul>
<li><strong>构建mysql镜像：</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@dmpdev docker-swarm-service]<span class="comment"># cd mysql</span></div><div class="line">[root@dmpdev mysql]<span class="comment"># ls</span></div><div class="line">city-db.sql  Dockerfile  my.cnf</div><div class="line">[root@dmpdev mysql]<span class="comment"># docker build -t tcr:5000/myhub/mysql:5.7-dws .</span></div><div class="line">Sending build context to Docker daemon 28.67 kB</div><div class="line">Step 1 : FROM mysql</div><div class="line"> ---&gt; d9124e6c552f</div><div class="line">Step 2 : MAINTAINER troylc &lt;troylc@163.com&gt;</div><div class="line"> ---&gt; Running <span class="keyword">in</span> 0b95a555c8cf</div><div class="line"> ---&gt; 5ab93bf1762d</div><div class="line">Removing intermediate container 0b95a555c8cf</div><div class="line">Step 3 : COPY city-db.sql /docker-entrypoint-initdb.d/city-db.sql</div><div class="line"> ---&gt; 81385fa16444</div><div class="line">Removing intermediate container 718e7a1369c3</div><div class="line">Step 4 : COPY my.cnf /etc/mysql/my.cnf</div><div class="line"> ---&gt; 5669d98b188a</div><div class="line">Removing intermediate container 926998a0e768</div><div class="line">Step 5 : RUN <span class="built_in">echo</span> <span class="string">"Asia/shanghai"</span> &gt; /etc/timezone</div><div class="line"> ---&gt; Running <span class="keyword">in</span> 9b23322b62db</div><div class="line"> ---&gt; ff6e7d0e75af</div><div class="line">Removing intermediate container 9b23322b62db</div><div class="line">Step 6 : EXPOSE 3306</div><div class="line"> ---&gt; Running <span class="keyword">in</span> 8bb45bc9c3e6</div><div class="line"> ---&gt; 9d71c84043af</div><div class="line">Removing intermediate container 8bb45bc9c3e6</div><div class="line">Successfully built 9d71c84043af</div></pre></td></tr></table></figure>
<p>push到docker私有仓库<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@dmpdev mysql]<span class="comment"># docker push tcr:5000/myhub/mysql:5.7-dws</span></div><div class="line">The push refers to a repository [tcr:5000/myhub/mysql]</div><div class="line">0b63e7f5c61b: Image successfully pushed </div><div class="line">a9103bf08dd6: Image successfully pushed </div><div class="line">4a8cfaac9133: Image successfully pushed </div><div class="line">ee30b869dd90: Image successfully pushed </div><div class="line">b5d824491b78: Already exists </div><div class="line">b26238180bc8: Already exists </div><div class="line">01e91410235e: Already exists </div><div class="line">b610b16e919f: Already exists </div><div class="line">1574ff8789b1: Already exists </div><div class="line">e7048a1643a4: Already exists </div><div class="line">1bc74a039df4: Already exists </div><div class="line">6ebad06b3e49: Already exists </div><div class="line">f1621398948b: Already exists </div><div class="line">fe4c16cbf7a4: Already exists </div><div class="line">Pushing tag <span class="keyword">for</span> rev [9d71c84043af] on &#123;http://tcr:5000/v1/repositories/myhub/mysql/tags/5.7-dws&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>构建bootService镜像：</strong>  </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@cloud03 mysql] <span class="built_in">cd</span> ../bootService/</div><div class="line">[root@cloud03 bootService]<span class="comment"># docker build -t tcr:5000/myhub/bootservice:1.0-dws .</span></div><div class="line">Sending build context to Docker daemon 28.77 MB</div><div class="line">Step 1 : FROM java:openjdk-8-jre-alpine</div><div class="line"> ---&gt; ed933d9cbb9b</div><div class="line">Step 2 : MAINTAINER troylc &lt;troylc@163.com&gt;</div><div class="line"> ---&gt; Running <span class="keyword">in</span> e020e5dc61a4</div><div class="line"> ---&gt; 1dca6a2dc31c</div><div class="line">Removing intermediate container e020e5dc61a4</div><div class="line">Step 3 : ADD springboot_controller-1.0-SNAPSHOT.jar /app.jar</div><div class="line"> ---&gt; 94d9cb5ce2a3</div><div class="line">Removing intermediate container f151c9ea203e</div><div class="line">Step 4 : EXPOSE 8888</div><div class="line"> ---&gt; Running <span class="keyword">in</span> 1257615513df</div><div class="line"> ---&gt; a192b60e42f7</div><div class="line">Removing intermediate container 1257615513df</div><div class="line">Step 5 : ENTRYPOINT java -jar /app.jar</div><div class="line"> ---&gt; Running <span class="keyword">in</span> 623ec299ddaa</div><div class="line"> ---&gt; 87e646e370af</div><div class="line">Removing intermediate container 623ec299ddaa</div><div class="line">Successfully built 87e646e370af</div><div class="line"></div><div class="line">[root@dmpdev mysql]<span class="comment"># docker push tcr:5000/myhub/bootservice:1.0-dws</span></div><div class="line">......</div></pre></td></tr></table></figure>
<ul>
<li><strong>构建nginx镜像：</strong>   </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">[root@cloud03 bootService] <span class="built_in">cd</span> ../nginx/</div><div class="line">[root@cloud03 nginx]<span class="comment"># docker build -t tcr:5000/myhub/nginx:1.11-dws .</span></div><div class="line">Sending build context to Docker daemon 7.168 kB</div><div class="line">Step 1 : FROM nginx</div><div class="line"> ---&gt; abf312888d13</div><div class="line">Step 2 : MAINTAINER troylc &lt;troylc@163.com&gt;</div><div class="line"> ---&gt; Running <span class="keyword">in</span> 883582f786a5</div><div class="line"> ---&gt; f234706e9ee5</div><div class="line">Removing intermediate container 883582f786a5</div><div class="line">Step 3 : COPY nginx.conf /etc/nginx/nginx.conf</div><div class="line"> ---&gt; 82053ab65cae</div><div class="line">Removing intermediate container b2eb37dd4ecc</div><div class="line">Step 4 : COPY default.conf /etc/nginx/conf.d/default.conf</div><div class="line"> ---&gt; f43184cfb2fa</div><div class="line">Removing intermediate container 0f7add1f3f67</div><div class="line">Step 5 : RUN mkdir -p /etc/nginx/logs</div><div class="line"> ---&gt; Running <span class="keyword">in</span> 74c0fbabe4ee</div><div class="line"> ---&gt; f20f5d30e5db</div><div class="line">Removing intermediate container 74c0fbabe4ee</div><div class="line">Step 6 : RUN <span class="built_in">echo</span> <span class="string">"Asia/shanghai"</span> &gt; /etc/timezonedo</div><div class="line"> ---&gt; Running <span class="keyword">in</span> 35003953a04b</div><div class="line"> ---&gt; b3bb199c7506</div><div class="line">Removing intermediate container 35003953a04b</div><div class="line">Step 7 : EXPOSE 80</div><div class="line"> ---&gt; Running <span class="keyword">in</span> 6d7ded8bb94b</div><div class="line"> ---&gt; 7e0d4b715b92</div><div class="line">Removing intermediate container 6d7ded8bb94b</div><div class="line">Successfully built 7e0d4b715b92</div><div class="line">[root@dmpdev mysql]<span class="comment"># docker push tcr:5000/myhub/nginx:1.11-dws</span></div><div class="line">......</div></pre></td></tr></table></figure>
<h4 id="创建overlay网络："><a href="#创建overlay网络：" class="headerlink" title="创建overlay网络："></a>创建overlay网络：</h4><p>my-network,使用overlay网络连接集群中的一个或多个服务。<br>在manager节点上创建overlay网络，使用docker network create命令：<br><strong>–driver overlay</strong> 网络类型<br><strong>–subnet 10.0.9.0/24</strong> 子网地址段<br><strong>–opt encrypted</strong> 给此网络加密（<a href="https://docs.docker.com/engine/userguide/networking/overlay-security-model/" target="_blank" rel="external">具体说明请参考：https://docs.docker.com/engine/userguide/networking/overlay-security-model/</a>）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">[root@cloud01 ~]<span class="comment">#  docker network create \</span></div><div class="line">&gt;   --driver overlay \</div><div class="line">&gt;   --subnet 10.0.9.0/24 \</div><div class="line">&gt;   --opt encrypted \</div><div class="line">&gt;   my-network</div><div class="line">bhna620fxpuryf2e1te6hui1t</div><div class="line">[root@cloud01 ~]<span class="comment"># docker network ls</span></div><div class="line">NETWORK ID          NAME                DRIVER              SCOPE</div><div class="line">8fd3e2a10dff        bridge              bridge              <span class="built_in">local</span>               </div><div class="line">987934476ba0        docker_gwbridge     bridge              <span class="built_in">local</span>               </div><div class="line">77ac8b224344        host                host                <span class="built_in">local</span>               </div><div class="line">aeyt32avj7kq        ingress             overlay             swarm               </div><div class="line">bhna620fxpur        my-network          overlay             swarm               </div><div class="line">436685dca07d        none                null                <span class="built_in">local</span>               </div><div class="line">[root@cloud01 ~]<span class="comment"># docker network inspect my-network</span></div><div class="line">[</div><div class="line">    &#123;</div><div class="line">        <span class="string">"Name"</span>: <span class="string">"my-network"</span>,</div><div class="line">        <span class="string">"Id"</span>: <span class="string">"bhna620fxpuryf2e1te6hui1t"</span>,</div><div class="line">        <span class="string">"Scope"</span>: <span class="string">"swarm"</span>,</div><div class="line">        <span class="string">"Driver"</span>: <span class="string">"overlay"</span>,</div><div class="line">        <span class="string">"EnableIPv6"</span>: <span class="literal">false</span>,</div><div class="line">        <span class="string">"IPAM"</span>: &#123;</div><div class="line">            <span class="string">"Driver"</span>: <span class="string">"default"</span>,</div><div class="line">            <span class="string">"Options"</span>: null,</div><div class="line">            <span class="string">"Config"</span>: [</div><div class="line">                &#123;</div><div class="line">                    <span class="string">"Subnet"</span>: <span class="string">"10.0.9.0/24"</span>,</div><div class="line">                    <span class="string">"Gateway"</span>: <span class="string">"10.0.9.1"</span></div><div class="line">                &#125;</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        <span class="string">"Internal"</span>: <span class="literal">false</span>,</div><div class="line">        <span class="string">"Containers"</span>: null,</div><div class="line">        <span class="string">"Options"</span>: &#123;</div><div class="line">            <span class="string">"com.docker.network.driver.overlay.vxlanid_list"</span>: <span class="string">"257"</span>,</div><div class="line">            <span class="string">"encrypted"</span>: <span class="string">""</span></div><div class="line">        &#125;,</div><div class="line">        <span class="string">"Labels"</span>: null</div><div class="line">    &#125;</div><div class="line">]</div><div class="line"></div><div class="line">```  </div><div class="line"><span class="comment">#### 创建mysql服务  </span></div><div class="line">在manager节点创建mysql服务，参数说明：  </div><div class="line">**--replicas :** 服务运行的副本个数  </div><div class="line">**--name :** 服务名称  </div><div class="line">**--network :** 服务运行时所处在的网络  </div><div class="line">**--endpoint-mode dnsrr :** 服务发现的方式dns  </div><div class="line">**--mount <span class="built_in">type</span>=<span class="built_in">bind</span> :** 服务以绑定方式挂载数据目录(挂载前宿主机目录必须先创建)  </div><div class="line">**--e :** 针对mysql服务创建时需要的启动参数  </div><div class="line">**--tcr:5000/myhub/mysql:5.7-dws** 所运行的镜像</div><div class="line"></div><div class="line">```bash</div><div class="line">[root@cloud01 ~]<span class="comment"># docker service create \</span></div><div class="line">   --replicas 1 \</div><div class="line">   --name mysql \</div><div class="line">   --network my-network \</div><div class="line">   --endpoint-mode dnsrr \</div><div class="line">   --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,src=/var/lib/mysql,dst=/var/lib/mysql \</div><div class="line">   -e MYSQL_ROOT_PASSWORD=talent \</div><div class="line">   -e MYSQL_DATABASE=citydb \</div><div class="line">   tcr:5000/myhub/mysql:5.7-dws</div><div class="line">33wyod9syd1fcq2ip58872ce6</div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ls</span></div><div class="line">ID            NAME   REPLICAS  IMAGE                         COMMAND</div><div class="line">33wyod9syd1f  mysql  0/1       tcr:5000/myhub/mysql:5.7-dws  </div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ps mysql </span></div><div class="line">ID                         NAME     IMAGE                         NODE        DESIRED STATE  CURRENT STATE             ERROR</div><div class="line">2nrar9c71olxrc7wo3ab6hxfh  mysql.1  tcr:5000/myhub/mysql:5.7-dws  cloud02  Running        Preparing 28 seconds ago  </div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ls</span></div><div class="line">ID            NAME   REPLICAS  IMAGE                         COMMAND</div><div class="line">33wyod9syd1f  mysql  1/1       tcr:5000/myhub/mysql:5.7-dws</div></pre></td></tr></table></figure>
<p>查看cloud02主机上是否运行了mysql数据库服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@cloud02 ~]<span class="comment"># docker ps -a</span></div><div class="line">CONTAINER ID        IMAGE                          COMMAND                  CREATED             STATUS              PORTS               NAMES</div><div class="line">d168b5948e55        tcr:5000/myhub/mysql:5.7-dws   <span class="string">"docker-entrypoint.sh"</span>   24 seconds ago      Up 22 seconds       3306/tcp            mysql.1.2nrar9c71olxrc7wo3ab6hxfh</div></pre></td></tr></table></figure>
<h4 id="创建bootService服务"><a href="#创建bootService服务" class="headerlink" title="创建bootService服务"></a>创建bootService服务</h4><p>在manager节点上操作创建3个容器副本的bootService服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@cloud01 ~]<span class="comment"># docker service create \</span></div><div class="line">   --replicas 3 \</div><div class="line">   --name bootService \</div><div class="line">   --network my-network \</div><div class="line">   --endpoint-mode dnsrr \</div><div class="line">   tcr:5000/myhub/bootservice:1.0-dws</div><div class="line">5cy0l5cuidlgqjqczwotikvke</div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ls</span></div><div class="line">ID            NAME         REPLICAS  IMAGE                               COMMAND</div><div class="line">33wyod9syd1f  mysql        1/1       tcr:5000/myhub/mysql:5.7-dws        </div><div class="line">5cy0l5cuidlg  bootService  2/3       tcr:5000/myhub/bootservice:1.0-dws  </div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ps bootService</span></div><div class="line">ID                         NAME           IMAGE                               NODE        DESIRED STATE  CURRENT STATE           ERROR</div><div class="line">b7va0y4dg01chnhu3hlvzi7o8  bootService.1  tcr:5000/myhub/bootservice:1.0-dws  cloud01  Running        Running 7 seconds ago   </div><div class="line">8zbgh0rl9w6amhmjxj2rmu627  bootService.2  tcr:5000/myhub/bootservice:1.0-dws  cloud03  Running        Running 22 seconds ago  </div><div class="line">3lgnfy11sgs4hj3375o30j5us  bootService.3  tcr:5000/myhub/bootservice:1.0-dws  cloud03  Running        Running 22 seconds ago  </div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ls</span></div><div class="line">ID            NAME         REPLICAS  IMAGE                               COMMAND</div><div class="line">33wyod9syd1f  mysql        1/1       tcr:5000/myhub/mysql:5.7-dws        </div><div class="line">5cy0l5cuidlg  bootService  3/3       tcr:5000/myhub/bootservice:1.0-dws  </div><div class="line">[root@cloud01 ~]<span class="comment"># docker ps -a</span></div><div class="line">CONTAINER ID        IMAGE                                COMMAND                CREATED             STATUS              PORTS               NAMES</div><div class="line">37218abdd4ec        tcr:5000/myhub/bootservice:1.0-dws   <span class="string">"java -jar /app.jar"</span>   41 seconds ago      Up 40 seconds       8888/tcp            bootService.1.b7va0y4dg01chnhu3hlvzi7o8</div></pre></td></tr></table></figure>
<p>在cloud03上看另外两个容器：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@cloud03 nginx]<span class="comment"># docker ps -a</span></div><div class="line">CONTAINER ID        IMAGE                                COMMAND                CREATED             STATUS              PORTS               NAMES</div><div class="line">4eef20ce8f95        tcr:5000/myhub/bootservice:1.0-dws   <span class="string">"java -jar /app.jar"</span>   2 minutes ago       Up 2 minutes        8888/tcp            bootService.2.8zbgh0rl9w6amhmjxj2rmu627</div><div class="line">960e905306e9        tcr:5000/myhub/bootservice:1.0-dws   <span class="string">"java -jar /app.jar"</span>   2 minutes ago       Up 2 minutes        8888/tcp            bootService.3.3lgnfy11sgs4hj3375o30j5us</div></pre></td></tr></table></figure>
<h4 id="创建nginx服务"><a href="#创建nginx服务" class="headerlink" title="创建nginx服务"></a>创建nginx服务</h4><p>在manager节点上操作创建运行2个容器副本的nginx服务:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@cloud01 ~]<span class="comment"># docker service create \</span></div><div class="line">  --name nginx \</div><div class="line">  --replicas 2 \</div><div class="line">  --publish 80:80 \</div><div class="line">  --network my-network \</div><div class="line">  tcr:5000/myhub/nginx:1.11-dws</div><div class="line">5cd0eaow2zp0ytul3muy71gcl</div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ls</span></div><div class="line">ID            NAME         REPLICAS  IMAGE                               COMMAND</div><div class="line">5cd0eaow2zp0  nginx        0/2       tcr:5000/myhub/nginx:1.11-dws       </div><div class="line">5v4kajpztp35  bootService  3/3       tcr:5000/myhub/bootservice:1.0-dws  </div><div class="line">6zpecsjj6ttm  mysql        1/1       tcr:5000/myhub/mysql:5.7-dws        </div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ps nginx</span></div><div class="line">ID                         NAME     IMAGE                          NODE        DESIRED STATE  CURRENT STATE           ERROR</div><div class="line">5aiaqlbvn36hn4q1n6vuzbfre  nginx.1  tcr:5000/myhub/nginx:1.11-dws  cloud03  Running        Running 1 seconds ago   </div><div class="line">c5y5ppps3i36wpsx5jovo7f8h  nginx.2  tcr:5000/myhub/nginx:1.11-dws  cloud01  Running        Running 11 seconds ago  </div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ls</span></div><div class="line">ID            NAME         REPLICAS  IMAGE                               COMMAND</div><div class="line">5cd0eaow2zp0  nginx        2/2       tcr:5000/myhub/nginx:1.11-dws       </div><div class="line">5v4kajpztp35  bootService  3/3       tcr:5000/myhub/bootservice:1.0-dws  </div><div class="line">6zpecsjj6ttm  mysql        1/1       tcr:5000/myhub/mysql:5.7-dws</div></pre></td></tr></table></figure>
<h3 id="服务的管理与测试"><a href="#服务的管理与测试" class="headerlink" title="服务的管理与测试"></a>服务的管理与测试</h3><ul>
<li><strong>访问应用测试</strong>  </li>
</ul>
<p>通过浏览器输入<a href="http://cloud01(对就服务的IP),如：" target="_blank" rel="external">http://cloud01(对就服务的IP),如：</a><br><img src="/images/docker/swarm/2-7.png" alt="应用测试">  </p>
<p>可以多次刷新一下，监控bootService服务打印出来的日志，他会帮你负载到不同的服务容器上，这里就不做说明了。</p>
<ul>
<li><strong>应用异常停止测试</strong>  </li>
</ul>
<p>找一台运行了bootService应用的机器手动停止容器，docker-swarm会根据你创建时副本的数量为标准，自动新建副本，以达到服务运行的要求，如下：<br>cloud02上停止一个bootService应用  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@cloud02 ~]<span class="comment"># docker ps -a</span></div><div class="line">CONTAINER ID        IMAGE                                COMMAND                CREATED             STATUS              PORTS               NAMES</div><div class="line">c5ade28e1900        tcr:5000/myhub/bootservice:1.0-dws   <span class="string">"java -jar /app.jar"</span>   3 hours ago         Up 3 hours          8888/tcp            bootService.2.9w5fhethqmyob9l27257ijl4k</div><div class="line">01aedb0fbdcd        tcr:5000/myhub/bootservice:1.0-dws   <span class="string">"java -jar /app.jar"</span>   3 hours ago         Up 3 hours          8888/tcp            bootService.3.0ixrtpss8jk62iqdq0z8q4z0g</div><div class="line">[root@cloud02 ~]<span class="comment"># docker stop bootService.3.0ixrtpss8jk62iqdq0z8q4z0g</span></div><div class="line">bootService.3.0ixrtpss8jk62iqdq0z8q4z0g</div><div class="line">[root@cloud02 ~]<span class="comment"># docker ps -a</span></div><div class="line">CONTAINER ID        IMAGE                                COMMAND                CREATED             STATUS                        PORTS               NAMES</div><div class="line">050cf1feb5b1        tcr:5000/myhub/bootservice:1.0-dws   <span class="string">"java -jar /app.jar"</span>   29 seconds ago      Up 28 seconds                 8888/tcp            bootService.3.dwbmcqnjwjlntujy6xzvss4qn</div><div class="line">c5ade28e1900        tcr:5000/myhub/bootservice:1.0-dws   <span class="string">"java -jar /app.jar"</span>   3 hours ago         Up 3 hours                    8888/tcp            bootService.2.9w5fhethqmyob9l27257ijl4k</div><div class="line">01aedb0fbdcd        tcr:5000/myhub/bootservice:1.0-dws   <span class="string">"java -jar /app.jar"</span>   3 hours ago         Exited (143) 34 seconds ago                       bootService.3.0ixrtpss8jk62iqdq0z8q4z0g</div><div class="line">[root@cloud02 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>在管理节点查看服务的状态：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@cloud01 ~]<span class="comment"># docker service ps bootService</span></div><div class="line">ID                         NAME               IMAGE                               NODE        DESIRED STATE  CURRENT STATE            ERROR</div><div class="line">0es1d8ia3e1u1budw422wgpyo  bootService.1      tcr:5000/myhub/bootservice:1.0-dws  cloud01  Running        Running 3 hours ago      </div><div class="line">9w5fhethqmyob9l27257ijl4k  bootService.2      tcr:5000/myhub/bootservice:1.0-dws  cloud02  Running        Running 3 hours ago      </div><div class="line">dwbmcqnjwjlntujy6xzvss4qn  bootService.3      tcr:5000/myhub/bootservice:1.0-dws  cloud02  Ready          Preparing 3 seconds ago  </div><div class="line">0ixrtpss8jk62iqdq0z8q4z0g   \_ bootService.3  tcr:5000/myhub/bootservice:1.0-dws  cloud02  Shutdown       Failed 3 seconds ago     <span class="string">"task: non-zero exit (143)"</span></div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ls</span></div><div class="line">ID            NAME         REPLICAS  IMAGE                               COMMAND</div><div class="line">5cd0eaow2zp0  nginx        2/2       tcr:5000/myhub/nginx:1.11-dws       </div><div class="line">5v4kajpztp35  bootService  3/3       tcr:5000/myhub/bootservice:1.0-dws  </div><div class="line">6zpecsjj6ttm  mysql        1/1       tcr:5000/myhub/mysql:5.7-dws        </div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ps bootService</span></div><div class="line">ID                         NAME               IMAGE                               NODE        DESIRED STATE  CURRENT STATE           ERROR</div><div class="line">0es1d8ia3e1u1budw422wgpyo  bootService.1      tcr:5000/myhub/bootservice:1.0-dws  cloud01  Running        Running 3 hours ago     </div><div class="line">9w5fhethqmyob9l27257ijl4k  bootService.2      tcr:5000/myhub/bootservice:1.0-dws  cloud02  Running        Running 3 hours ago     </div><div class="line">dwbmcqnjwjlntujy6xzvss4qn  bootService.3      tcr:5000/myhub/bootservice:1.0-dws  cloud02  Running        Running 16 seconds ago  </div><div class="line">0ixrtpss8jk62iqdq0z8q4z0g   \_ bootService.3  tcr:5000/myhub/bootservice:1.0-dws  cloud02  Shutdown       Failed 22 seconds ago   <span class="string">"task: non-zero exit (143)"</span></div></pre></td></tr></table></figure>
<ul>
<li><strong>宿主机停机扩容，更新测试</strong>：  </li>
</ul>
<p>现在如果有一台宿主机的容量，或者内存等以达到了峰值，想对这台主机进行停机扩容，或者相关的系统更新等操作，可以修改主机的集群可见性状态  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">[root@cloud01 ~]<span class="comment"># docker node ls</span></div><div class="line">ID                           HOSTNAME    STATUS  AVAILABILITY  MANAGER STATUS</div><div class="line">ap235xkm64tj0al4gdzqbpwmi *  cloud01  Ready   Active        Leader</div><div class="line">don6u2knphk92ugdvfgdymu2t    cloud03  Ready   Active        </div><div class="line">f1ocfd3u8na92f2to8txdogop    cloud02  Ready   Active        </div><div class="line">[root@cloud01 ~]<span class="comment"># docker node update --availability Drain cloud02</span></div><div class="line">cloud02</div><div class="line">[root@cloud01 ~]<span class="comment"># docker node ls</span></div><div class="line">ID                           HOSTNAME    STATUS  AVAILABILITY  MANAGER STATUS</div><div class="line">ap235xkm64tj0al4gdzqbpwmi *  cloud01  Ready   Active        Leader</div><div class="line">don6u2knphk92ugdvfgdymu2t    cloud03  Ready   Active        </div><div class="line">f1ocfd3u8na92f2to8txdogop    cloud02  Ready   Drain         </div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ls</span></div><div class="line">ID            NAME         REPLICAS  IMAGE                               COMMAND</div><div class="line">5cd0eaow2zp0  nginx        2/2       tcr:5000/myhub/nginx:1.11-dws       </div><div class="line">5v4kajpztp35  bootService  3/3       tcr:5000/myhub/bootservice:1.0-dws  </div><div class="line">6zpecsjj6ttm  mysql        1/1       tcr:5000/myhub/mysql:5.7-dws        </div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ps nginx</span></div><div class="line">ID                         NAME     IMAGE                          NODE        DESIRED STATE  CURRENT STATE        ERROR</div><div class="line">5aiaqlbvn36hn4q1n6vuzbfre  nginx.1  tcr:5000/myhub/nginx:1.11-dws  cloud03  Running        Running 4 hours ago  </div><div class="line">c5y5ppps3i36wpsx5jovo7f8h  nginx.2  tcr:5000/myhub/nginx:1.11-dws  cloud01  Running        Running 4 hours ago  </div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ps mysql</span></div><div class="line">ID                         NAME     IMAGE                         NODE        DESIRED STATE  CURRENT STATE        ERROR</div><div class="line">488dnyp5czuwta2velkeidxxh  mysql.1  tcr:5000/myhub/mysql:5.7-dws  cloud03  Running        Running 4 hours ago  </div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ps bootService</span></div><div class="line">ID                         NAME               IMAGE                               NODE        DESIRED STATE  CURRENT STATE             ERROR</div><div class="line">0es1d8ia3e1u1budw422wgpyo  bootService.1      tcr:5000/myhub/bootservice:1.0-dws  cloud01  Running        Running 4 hours ago       </div><div class="line">9tcl88byfznsez65av2x0hq94  bootService.2      tcr:5000/myhub/bootservice:1.0-dws  cloud03  Running        Running 54 seconds ago    </div><div class="line">9w5fhethqmyob9l27257ijl4k   \_ bootService.2  tcr:5000/myhub/bootservice:1.0-dws  cloud02  Shutdown       Shutdown 58 seconds ago   </div><div class="line">5spkzjw760w4zbd79qiy1xc0u  bootService.3      tcr:5000/myhub/bootservice:1.0-dws  cloud01  Running        Running 54 seconds ago    </div><div class="line">dwbmcqnjwjlntujy6xzvss4qn   \_ bootService.3  tcr:5000/myhub/bootservice:1.0-dws  cloud02  Shutdown       Shutdown 59 seconds ago   </div><div class="line">0ixrtpss8jk62iqdq0z8q4z0g   \_ bootService.3  tcr:5000/myhub/bootservice:1.0-dws  cloud02  Shutdown       Failed about an hour ago  <span class="string">"task: non-zero exit (143)"</span></div></pre></td></tr></table></figure>
<p>通过以上测试可以发现运行在cloud02上的容器全部停止，并且swarm集群会自动迁移cloud02上的容器到其它宿主机上。这样我们就可以在cloud02上进行硬件升级操作，等升级完后，可以进行恢复操作，如：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[root@cloud01 ~]# docker node update --availability Active cloud02</div><div class="line">cloud02</div><div class="line">[root@cloud01 ~]# docker node ls</div><div class="line">ID                           HOSTNAME    STATUS  AVAILABILITY  MANAGER STATUS</div><div class="line">ap235xkm64tj0al4gdzqbpwmi *  cloud01  Ready   Active        Leader</div><div class="line">don6u2knphk92ugdvfgdymu2t    cloud03  Ready   Active        </div><div class="line">f1ocfd3u8na92f2to8txdogop    cloud02  Ready   Active        </div><div class="line">[root@cloud01 ~]# docker service ls</div><div class="line">ID            NAME         REPLICAS  IMAGE                               COMMAND</div><div class="line">5cd0eaow2zp0  nginx        2/2       tcr:5000/myhub/nginx:1.11-dws       </div><div class="line">5v4kajpztp35  bootService  3/3       tcr:5000/myhub/bootservice:1.0-dws  </div><div class="line">6zpecsjj6ttm  mysql        1/1       tcr:5000/myhub/mysql:5.7-dws        </div><div class="line">[root@cloud01 ~]# docker service ps nginx</div><div class="line">ID                         NAME     IMAGE                          NODE        DESIRED STATE  CURRENT STATE        ERROR</div><div class="line">5aiaqlbvn36hn4q1n6vuzbfre  nginx.1  tcr:5000/myhub/nginx:1.11-dws  cloud03  Running        Running 5 hours ago  </div><div class="line">c5y5ppps3i36wpsx5jovo7f8h  nginx.2  tcr:5000/myhub/nginx:1.11-dws  cloud01  Running        Running 5 hours ago  </div><div class="line">[root@cloud01 ~]# docker service ps mysql</div><div class="line">ID                         NAME     IMAGE                         NODE        DESIRED STATE  CURRENT STATE        ERROR</div><div class="line">488dnyp5czuwta2velkeidxxh  mysql.1  tcr:5000/myhub/mysql:5.7-dws  cloud03  Running        Running 5 hours ago  </div><div class="line">[root@cloud01 ~]# docker service ps bootService</div><div class="line">ID                         NAME               IMAGE                               NODE        DESIRED STATE  CURRENT STATE             ERROR</div><div class="line">0es1d8ia3e1u1budw422wgpyo  bootService.1      tcr:5000/myhub/bootservice:1.0-dws  cloud01  Running        Running 5 hours ago       </div><div class="line">9tcl88byfznsez65av2x0hq94  bootService.2      tcr:5000/myhub/bootservice:1.0-dws  cloud03  Running        Running 11 minutes ago    </div><div class="line">9w5fhethqmyob9l27257ijl4k   \_ bootService.2  tcr:5000/myhub/bootservice:1.0-dws  cloud02  Shutdown       Shutdown 11 minutes ago   </div><div class="line">5spkzjw760w4zbd79qiy1xc0u  bootService.3      tcr:5000/myhub/bootservice:1.0-dws  cloud01  Running        Running 11 minutes ago    </div><div class="line">dwbmcqnjwjlntujy6xzvss4qn   \_ bootService.3  tcr:5000/myhub/bootservice:1.0-dws  cloud02  Shutdown       Shutdown 11 minutes ago   </div><div class="line">0ixrtpss8jk62iqdq0z8q4z0g   \_ bootService.3  tcr:5000/myhub/bootservice:1.0-dws  cloud02  Shutdown       Failed about an hour ago  &quot;task: non-zero exit (143)&quot;</div></pre></td></tr></table></figure>
<p>恢复回来的主机cloud02，集群并没有把之前在这台主机上运行的容器恢复，他只是会在之前创建service时，会加大在这台主机运行容器的权重，比如接下来我加大对bootService的副本的个为6个，集群应该会优先在cloud02上运行.</p>
<ul>
<li><strong>调整service的副本数：</strong>  </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@cloud01 ~]<span class="comment"># docker service scale bootService=6</span></div><div class="line">bootService scaled to 6</div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ls</span></div><div class="line">ID            NAME         REPLICAS  IMAGE                               COMMAND</div><div class="line">5cd0eaow2zp0  nginx        2/2       tcr:5000/myhub/nginx:1.11-dws       </div><div class="line">5v4kajpztp35  bootService  3/6       tcr:5000/myhub/bootservice:1.0-dws  </div><div class="line">6zpecsjj6ttm  mysql        1/1       tcr:5000/myhub/mysql:5.7-dws        </div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ps bootService</span></div><div class="line">ID                         NAME               IMAGE                               NODE        DESIRED STATE  CURRENT STATE               ERROR</div><div class="line">0es1d8ia3e1u1budw422wgpyo  bootService.1      tcr:5000/myhub/bootservice:1.0-dws  cloud01  Running        Running 6 hours ago         </div><div class="line">9tcl88byfznsez65av2x0hq94  bootService.2      tcr:5000/myhub/bootservice:1.0-dws  cloud03  Running        Running about an hour ago   </div><div class="line">9w5fhethqmyob9l27257ijl4k   \_ bootService.2  tcr:5000/myhub/bootservice:1.0-dws  cloud02  Shutdown       Shutdown about an hour ago  </div><div class="line">5spkzjw760w4zbd79qiy1xc0u  bootService.3      tcr:5000/myhub/bootservice:1.0-dws  cloud01  Running        Running about an hour ago   </div><div class="line">dwbmcqnjwjlntujy6xzvss4qn   \_ bootService.3  tcr:5000/myhub/bootservice:1.0-dws  cloud02  Shutdown       Shutdown about an hour ago  </div><div class="line">0ixrtpss8jk62iqdq0z8q4z0g   \_ bootService.3  tcr:5000/myhub/bootservice:1.0-dws  cloud02  Shutdown       Failed 2 hours ago          <span class="string">"task: non-zero exit (143)"</span></div><div class="line">df2gl62u120hix9ixmdvxmr7s  bootService.4      tcr:5000/myhub/bootservice:1.0-dws  cloud02  Running        Running 12 seconds ago      </div><div class="line">8jauwg0g07qgcjwydfil71uei  bootService.5      tcr:5000/myhub/bootservice:1.0-dws  cloud02  Running        Running 13 seconds ago      </div><div class="line">f4xwd11aof6rxxf1alovq8ulp  bootService.6      tcr:5000/myhub/bootservice:1.0-dws  cloud02  Running        Running 12 seconds ago      </div><div class="line">[root@cloud01 ~]<span class="comment"># docker service ls</span></div><div class="line">ID            NAME         REPLICAS  IMAGE                               COMMAND</div><div class="line">5cd0eaow2zp0  nginx        2/2       tcr:5000/myhub/nginx:1.11-dws       </div><div class="line">5v4kajpztp35  bootService  6/6       tcr:5000/myhub/bootservice:1.0-dws  </div><div class="line">6zpecsjj6ttm  mysql        1/1       tcr:5000/myhub/mysql:5.7-dws</div></pre></td></tr></table></figure>
<p>可以看到在增加3个bootService的副本时，他把三个副本都在cloud02上运行</p>
<ul>
<li><strong>service在线滚动升级：</strong>  </li>
<li>[x] 升级之前需要修改代码程序，比如：  </li>
</ul>
<p><img src="/images/docker/swarm/2-8.png" alt="更新代码"></p>
<ul>
<li>[x] 重新build镜像<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">[root@cloud03 bootService]<span class="comment"># docker build -t tcr:5000/myhub/bootservice:2.0-dws .</span></div><div class="line">Sending build context to Docker daemon 57.54 MB</div><div class="line">Step 1 : FROM java:openjdk-8-jre-alpine</div><div class="line"> ---&gt; ed933d9cbb9b</div><div class="line">Step 2 : MAINTAINER troylc &lt;troylc@163.com&gt;</div><div class="line"> ---&gt; Running <span class="keyword">in</span> 1541be2de9a0</div><div class="line"> ---&gt; 045d03ddb174</div><div class="line">Removing intermediate container 1541be2de9a0</div><div class="line">Step 3 : ADD springboot_controller-1.0-SNAPSHOT.jar /app.jar</div><div class="line"> ---&gt; 7cdbe5b89ad9</div><div class="line">Removing intermediate container 812ee39672ec</div><div class="line">Step 4 : EXPOSE 8888</div><div class="line"> ---&gt; Running <span class="keyword">in</span> f606dddc345b</div><div class="line"> ---&gt; 5c3d29d21ffc</div><div class="line">Removing intermediate container f606dddc345b</div><div class="line">Step 5 : ENTRYPOINT java -jar /app.jar</div><div class="line"> ---&gt; Running <span class="keyword">in</span> 21950f69009e</div><div class="line"> ---&gt; 4c051321084e</div><div class="line">Removing intermediate container 21950f69009e</div><div class="line">Successfully built 4c051321084e</div><div class="line">[root@cloud03 bootService]<span class="comment"># docker images</span></div><div class="line">REPOSITORY                   TAG                    IMAGE ID            CREATED             SIZE</div><div class="line">tcr:5000/myhub/bootservice   2.0-dws                4c051321084e        8 seconds ago       136.6 MB</div><div class="line">tcr:5000/myhub/nginx         1.11-dws               ac60c7d1de84        8 hours ago         181.5 MB</div><div class="line">tcr:5000/myhub/bootservice   1.0-dws                efde01242708        8 hours ago         136.6 MB</div><div class="line">tcr:5000/myhub/mysql         5.7-dws                ab71fac9c8e0        23 hours ago        383.4 MB</div><div class="line">nginx                        latest                 abf312888d13        2 days ago          181.5 MB</div><div class="line">tcr:5000/myhub/dmpmysql      latest                 a0af62341076        7 days ago          374.1 MB</div><div class="line">tcr:5000/myhub/mysql         5.7                    261ed3d3451f        7 days ago          383.4 MB</div><div class="line">java                         openjdk-8-jre-alpine   ed933d9cbb9b        13 days ago         107.8 MB</div><div class="line">[root@cloud03 bootService]<span class="comment"># docker push tcr:5000/myhub/bootservice:2.0-dws</span></div><div class="line">The push refers to a repository [tcr:5000/myhub/bootservice]</div><div class="line">0ab32fba5be5: Image successfully pushed </div><div class="line">d1052adb22b9: Already exists </div><div class="line">30125717c842: Already exists </div><div class="line">011b303988d2: Already exists </div><div class="line">Pushing tag <span class="keyword">for</span> rev [4c051321084e] on &#123;http://tcr:5000/v1/repositories/myhub/bootservice/tags/2.0-dws&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>为了跟踪查询我们bootService服务在滚动更新中的状态, 我们新开一个ssh窗口连接cloud01, 执行watch命令, 监控worker服务状态:<br>如下命令可以打开一个监控窗口, 每秒监控我们worker服务的状态变化:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@cloud01 ~]<span class="comment"># watch -n1 "docker service ps bootService | grep -v Shutdown.*Shutdown"</span></div><div class="line">Every 1.0s: docker service ps bootService | grep -v Shutdown.*Shutdown                                                                                                           Thu Dec  1 17:52:55 2016</div><div class="line"></div><div class="line">ID                         NAME               IMAGE                               NODE        DESIRED STATE  CURRENT STATE              ERROR</div><div class="line">0es1d8ia3e1u1budw422wgpyo  bootService.1      tcr:5000/myhub/bootservice:1.0-dws  cloud01  Running        Running 7 hours ago</div><div class="line">9tcl88byfznsez65av2x0hq94  bootService.2      tcr:5000/myhub/bootservice:1.0-dws  cloud03  Running        Running 2 hours ago</div><div class="line">5spkzjw760w4zbd79qiy1xc0u  bootService.3      tcr:5000/myhub/bootservice:1.0-dws  cloud01  Running        Running 2 hours ago</div><div class="line">0ixrtpss8jk62iqdq0z8q4z0g   \_ bootService.3  tcr:5000/myhub/bootservice:1.0-dws  cloud02  Shutdown       Failed 4 hours ago         <span class="string">"task: non-zero exit (143)"</span></div><div class="line">df2gl62u120hix9ixmdvxmr7s  bootService.4      tcr:5000/myhub/bootservice:1.0-dws  cloud02  Running        Running about an hour ago</div><div class="line">8jauwg0g07qgcjwydfil71uei  bootService.5      tcr:5000/myhub/bootservice:1.0-dws  cloud02  Running        Running about an hour ago</div><div class="line">f4xwd11aof6rxxf1alovq8ulp  bootService.6      tcr:5000/myhub/bootservice:1.0-dws  cloud02  Running        Running about an hour ago</div></pre></td></tr></table></figure>
<p>下面我们有了新bootService服务的镜像2.0-dws, 我们来滚动更新我们的6个bootService:  </p>
<p>这里只用docker service update 命令:<br><strong>–update-parallelism</strong>指定每次update的容器数量<br><strong>–update-delay</strong> 每次更新之后的等待时间.<br><strong>–image</strong>后面跟服务镜像名称  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@cloud01 ~]# docker service ls</div><div class="line">ID            NAME         REPLICAS  IMAGE                               COMMAND</div><div class="line">5cd0eaow2zp0  nginx        2/2       tcr:5000/myhub/nginx:1.11-dws       </div><div class="line">5v4kajpztp35  bootService  6/6       tcr:5000/myhub/bootservice:1.0-dws  </div><div class="line">6zpecsjj6ttm  mysql        1/1       tcr:5000/myhub/mysql:5.7-dws        </div><div class="line">[root@cloud01 ~]# docker service update bootService --update-parallelism 2 --update-delay 5s --image tcr:5000/myhub/bootservice:2.0-dws</div><div class="line">bootService</div><div class="line">[root@cloud01 ~]# docker service ls</div><div class="line">ID            NAME         REPLICAS  IMAGE                               COMMAND</div><div class="line">5cd0eaow2zp0  nginx        2/2       tcr:5000/myhub/nginx:1.11-dws       </div><div class="line">5v4kajpztp35  bootService  6/6       tcr:5000/myhub/bootservice:2.0-dws  </div><div class="line">6zpecsjj6ttm  mysql        1/1       tcr:5000/myhub/mysql:5.7-dws        </div><div class="line">[root@cloud01 ~]#</div></pre></td></tr></table></figure>
<p>执行完后，查看上面打开的监控情况，发现他会按照你指定的更新参数，升级bootService服务。<br>打开页面验证<br><img src="/images/docker/swarm/2-9.png" alt="验证2.0版本"></p>
<ul>
<li><strong>容器服务回滚</strong>  </li>
</ul>
<p>如果我们发现, 新版本bootService有问题希望回滚怎么办呢.<br>很简单, 跟上面更新的命令一样啊, 直接只用v0.1版本的镜像就可以了.<br>上面我们演示了滚动更新, 如果你希望一次性都更新或者回滚呢, 更简单了, 不加参数就行了.</p>
<p>下面我们一次性回滚所有bootService服务到1.0版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@cloud01 ~]# docker service update bootService --image tcr:5000/myhub/bootservice:1.0-dws</div><div class="line">bootService</div><div class="line">[root@cloud01 ~]# docker service ls</div><div class="line">ID            NAME         REPLICAS  IMAGE                               COMMAND</div><div class="line">5cd0eaow2zp0  nginx        2/2       tcr:5000/myhub/nginx:1.11-dws       </div><div class="line">5v4kajpztp35  bootService  6/6       tcr:5000/myhub/bootservice:1.0-dws  </div><div class="line">6zpecsjj6ttm  mysql        1/1       tcr:5000/myhub/mysql:5.7-dws</div></pre></td></tr></table></figure>
<p>可以看到bootService服务都回滚到1.0-dws版本了.</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.troylc.cc/docker/2017/02/19/Docker07docker-swarm02.html" data-id="cj7n4uk7y000c8hs6eoqz3qmv" class="article-share-link">分享</a><div class="tags"><a href="/tags/docker/">docker</a><a href="/tags/swarm/">swarm</a></div><div class="post-nav"><a href="/docker-compose/2017/02/25/Docker08docker-compose01.html" class="pre">docker-compose部署swarm服务(docker1.13.1)</a><a href="/java/2017/02/15/java01-thread-tools.html" class="next">java中并发工具包-同步器（一）</a></div><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div><script>var cloudTieConfig = {
  url: document.location.href,
  productKey: "7f1583d5aedb4104a3126007070841b0",
  target: "cloud-tie-wrapper"
};</script><script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CI-CD/">CI/CD</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/CI-CD/gitlab/">gitlab</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/IntelliJ-IDEA/">IntelliJ IDEA</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/certificate/">certificate</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/certificate/nginx/">nginx</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/certificate/nginx/macOs/">macOs</a><span class="category-list-count">1</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker-swarm/">docker swarm</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/docker-swarm/docker/">docker</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/docker-swarm/docker/docker-compose/">docker-compose</a><span class="category-list-count">1</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker-compose/">docker-compose</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/macOs/">macOs</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/rancher/">rancher</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring-cloud/">spring cloud</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/experience/">心得</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/jenkins/" style="font-size: 15px;">jenkins</a> <a href="/tags/registry/" style="font-size: 15px;">registry</a> <a href="/tags/swarm/" style="font-size: 15px;">swarm</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/心得/" style="font-size: 15px;">心得</a> <a href="/tags/docker-compose/" style="font-size: 15px;">docker-compose</a> <a href="/tags/hexo优化/" style="font-size: 15px;">hexo优化</a> <a href="/tags/jacman/" style="font-size: 15px;">jacman</a> <a href="/tags/rancher/" style="font-size: 15px;">rancher</a> <a href="/tags/kvm/" style="font-size: 15px;">kvm</a> <a href="/tags/win7/" style="font-size: 15px;">win7</a> <a href="/tags/Dockerfile/" style="font-size: 15px;">Dockerfile</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/docker-ui/" style="font-size: 15px;">docker-ui</a> <a href="/tags/macOs/" style="font-size: 15px;">macOs</a> <a href="/tags/IntelliJIDEA/" style="font-size: 15px;">IntelliJIDEA</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/Thread/" style="font-size: 15px;">Thread</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/zsh/" style="font-size: 15px;">zsh</a> <a href="/tags/spring-boot/" style="font-size: 15px;">spring-boot</a> <a href="/tags/spring-cloud/" style="font-size: 15px;">spring cloud</a> <a href="/tags/certificate-nginx/" style="font-size: 15px;">certificate nginx</a> <a href="/tags/chrome/" style="font-size: 15px;">chrome</a> <a href="/tags/gitlab/" style="font-size: 15px;">gitlab</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/CI-CD/gitlab/2018/01/04/cicd-gitlab.html">持续集成(CI)与持续交付(CD)之gitlab服务安装与配置</a></li><li class="post-list-item"><a class="post-list-link" href="/certificate/nginx/macOs/2017/11/27/nginx-chrome-ce.html">自签根证书和多子域名证书在浏览器上变安全绿</a></li><li class="post-list-item"><a class="post-list-link" href="/docker-swarm/docker/docker-compose/2017/10/27/docker-swarm-stack-compose-order.html">docker容器及swarm集群之compose健康检查与容器依赖</a></li><li class="post-list-item"><a class="post-list-link" href="/docker/2017/09/16/docker-ui-portainer.html">docker及swarm-mode之docker-ui实践-portainer</a></li><li class="post-list-item"><a class="post-list-link" href="/rancher/2017/09/03/docker-kvm-win7.html">ranchervm上运行kvm的win7-docker容器</a></li><li class="post-list-item"><a class="post-list-link" href="/docker/2017/07/28/dockerfile-alpine-tz-curl.html">Dockerfile制作openjdk-8u131-jdk-alpine基础镜像</a></li><li class="post-list-item"><a class="post-list-link" href="/docker/2017/06/20/docker-registry-web.html">docker-registry私有仓库及web ui镜像管理</a></li><li class="post-list-item"><a class="post-list-link" href="/IntelliJ-IDEA/2017/06/17/idea-01.html">IntelliJ IDEA For Mac 快捷键</a></li><li class="post-list-item"><a class="post-list-link" href="/macOs/2017/06/12/macos-02.html">macOs环境下搭建hexo静态博客</a></li><li class="post-list-item"><a class="post-list-link" href="/macOs/2017/06/11/macos-01.html">macOs终端工具优化iTerm2+oh my zsh</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.haomwei.com" title="屠夫9441的博客" target="_blank">屠夫9441的博客</a><ul></ul><a href="http://www.troylc.cc/" title="troylc博客" target="_blank">troylc博客</a></div><div class="widget"><div class="widget-title"><i class="fa fa-bar-chart"> 网站访问量</i></div><ul> </ul><a href="http://s05.flagcounter.com/more/IVe"><img src="http://s05.flagcounter.com/countxl/IVe/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/percent_0/" alt="" border="0" /></a></div><div class="widget"><div class="widget-title"><i class="fa fa-weibo"> 我的微博</i></div><ul> </ul><iframe width="100%" height="120 class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=199&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=2705524937&verifier=0f81d6c8&dpc=1"></iframe></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">troyCoder.</a> <a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a> <img src="https://dn-coding-net-production-static.qbox.me/static/fbaf53c3aad0d2346a81107b400e8071.png" alt="Hosted by Coding Pages"/></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?b991924b21cd080f0a0e761ff1a69288";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>